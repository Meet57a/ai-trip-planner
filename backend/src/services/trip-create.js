const { verifyToken } = require("../utils/token");
const {
    GoogleGenerativeAI,
} = require("@google/generative-ai");
const TripModel = require("../models/trip-model");

const apiKey = process.env.GEMINI_API_KEY;
const genAI = new GoogleGenerativeAI(apiKey);

const model = genAI.getGenerativeModel({
    model: "gemini-2.0-flash",
});

const generationConfig = {
    temperature: 1,
    topP: 0.95,
    topK: 40,
    maxOutputTokens: 8192,
    responseModalities: [

    ],
    responseMimeType: "application/json",
};

exports.createTripService = async (req, res) => {
    try {
        const token = req.headers.authorization;
        const splited = token.split(" ")[1];
        const user = verifyToken(splited);
        const { prompt } = req.body;
        console.log("prompt", prompt);
        const chatSession = model.startChat({
            generationConfig,
            history: [
                {
                    role: "user",
                    parts: [
                        { text: "Generate a detailed travel plan for {destination} from {startDate} to {endDate} within a {budget} budget. The plan should include budget estimation by calculating approximate costs for accommodation, travel, and activities. Provide a list of hotels based on the preferred {accommodationType}, including details such as hotel name, address, price per night, image URL, geo coordinates, rating, and a brief description. Additionally, incorporate AI-based recommendations for hotels, attractions, restaurants, and transport options tailored to the user's {travelType} and {preferredActivities}. The itinerary should be structured with a day-wise schedule, suggesting the best time to visit each location and including place names, descriptions, image URLs, geo coordinates, ticket pricing, and estimated travel time between locations. Integrate a real-time weather forecast for the selected destination to help users plan accordingly. Consider any {additionalRequests} to ensure a personalized and optimized travel experience. Present the output in JSON format for seamless integration.\n\n\n\n\n\n\n\n\n" },
                    ],
                },
                {
                    role: "model",
                    parts: [
                        { text: "Okay, I can create a detailed travel plan in JSON format based on your provided parameters.  Let's start by defining some variables to represent your placeholders.  Remember to replace these with your specific details!\n\n```json\n{\n  \"queryParameters\": {\n    \"destination\": \"Paris, France\",\n    \"startDate\": \"2024-03-15\",\n    \"endDate\": \"2024-03-22\",\n    \"budget\": \"1500 EUR\",\n    \"accommodationType\": \"boutique hotels\",\n    \"travelType\": \"solo traveler\",\n    \"preferredActivities\": [\"art museums\", \"historical sites\", \"local food experiences\"],\n    \"additionalRequests\": [\"vegetarian-friendly restaurants\", \"avoid crowded tourist areas\", \"easy access to public transport\"]\n  },\n  \"planName\": \"Paris Adventure\",\n  \"budgetEstimation\": {\n    \"currency\": \"EUR\",\n    \"accommodation\": {\n      \"estimatedCost\": 700,\n      \"description\": \"7 nights in boutique hotels (approx. 100 EUR per night)\"\n    },\n    \"travel\": {\n      \"estimatedCost\": 400,\n      \"description\": \"Round-trip flight and local transport (metro, bus)\"\n    },\n    \"activities\": {\n      \"estimatedCost\": 300,\n      \"description\": \"Museum entrance fees, food experiences, etc.\"\n    },\n    \"miscellaneous\": {\n      \"estimatedCost\": 100,\n      \"description\": \"Souvenirs, unexpected expenses\"\n    },\n    \"totalEstimatedCost\": 1500\n  },\n  \"accommodationOptions\": [\n    {\n      \"hotelName\": \"Hotel Fabric\",\n      \"address\": \"31 Rue de la Folie Méricourt, 75011 Paris, France\",\n      \"pricePerNight\": 120,\n      \"imageURL\": \"https://example.com/hotel_fabric.jpg\",\n      \"geoCoordinates\": {\n        \"latitude\": 48.865,\n        \"longitude\": 2.367\n      },\n      \"rating\": 4.5,\n      \"description\": \"Stylish boutique hotel in a former textile factory, close to the Marais district.\",\n      \"aiRecommendation\": \"Excellent location for exploring art galleries and enjoying the Parisian atmosphere.\"\n    },\n    {\n      \"hotelName\": \"Le Bristol Paris\",\n      \"address\": \"112 Rue du Faubourg Saint-Honoré, 75008 Paris, France\",\n      \"pricePerNight\": 1000,\n      \"imageURL\": \"https://example.com/lebristol.jpg\",\n      \"geoCoordinates\": {\n        \"latitude\": 48.871,\n        \"longitude\": 2.313\n      },\n      \"rating\": 5.0,\n      \"description\": \"Upscale hotel known for its stunning rooftop pool and exceptional service\",\n      \"aiRecommendation\": \"If budget is less of an issue, this hotel is highly regarded for exceptional service and luxurious accommodations in Paris.\"\n    },\n\t {\n      \"hotelName\": \"Hôtel Saint-André des Arts\",\n      \"address\": \"27 Rue Saint-André des Arts, 75006 Paris, France\",\n      \"pricePerNight\": 150,\n      \"imageURL\": \"https://example.com/hotelsainandredesarts.jpg\",\n      \"geoCoordinates\": {\n        \"latitude\": 48.8538,\n        \"longitude\": 2.3396\n      },\n      \"rating\": 4.2,\n      \"description\": \"Charming hotel in the Saint-Germain-des-Prés district, within easy walking distance of many attractions.\",\n      \"aiRecommendation\": \"This hotel has good access to main attractions like Louvre and Notre Dame.\"\n    }\n  ],\n  \"aiRecommendations\": {\n    \"attractions\": [\n      \"Musée Rodin: Beautiful sculpture garden and museum dedicated to Auguste Rodin (fits art museum preference).\",\n      \"Le Marais district: Historic district with charming streets, art galleries, and unique shops (avoids crowded areas request).\",\n      \"Canal Saint-Martin: Picturesque canal area with trendy cafes and a relaxed atmosphere (avoids crowded areas request).\"\n    ],\n    \"restaurants\": [\n      \"L'Arpège (vegetarian options available): Michelin-starred restaurant with a focus on seasonal vegetables (vegetarian-friendly request).\",\n      \"Breizh Café: Authentic Breton crêpes with savory and sweet options (local food experience).\",\n      \"Le Potager du Marais: Vegan restaurant in the Marais district (vegetarian-friendly request, local food experience).\"\n    ],\n    \"transport\": [\n      \"Paris Metro: Extensive and efficient subway system for getting around the city (easy access to public transport request).\",\n      \"Vélib' Métropole: Public bicycle sharing system for exploring at your own pace.\"\n    ]\n  },\n  \"itinerary\": [\n    {\n      \"day\": 1,\n      \"date\": \"2024-03-15\",\n      \"schedule\": [\n        {\n          \"time\": \"Morning\",\n          \"locationName\": \"Eiffel Tower\",\n          \"description\": \"Iconic landmark offering stunning views of Paris.\",\n          \"imageURL\": \"https://example.com/eiffel_tower.jpg\",\n          \"geoCoordinates\": {\n            \"latitude\": 48.8584,\n            \"longitude\": 2.2945\n          },\n          \"ticketPricing\": {\n            \"adult\": 26.80,\n            \"child\": 7.10,\n            \"currency\": \"EUR\"\n          },\n          \"estimatedTravelTime\": \"From hotel: 30 minutes by metro\",\n          \"aiRecommendation\": \"Visit early in the morning to avoid long queues.\"\n        },\n        {\n          \"time\": \"Afternoon\",\n          \"locationName\": \"Champ de Mars\",\n          \"description\": \"Large public park at the foot of the Eiffel Tower.\",\n          \"imageURL\": \"https://example.com/champ_de_mars.jpg\",\n          \"geoCoordinates\": {\n            \"latitude\": 48.8561,\n            \"longitude\": 2.2974\n          },\n          \"ticketPricing\": {\n            \"adult\": 0,\n            \"child\": 0,\n            \"currency\": \"EUR\"\n          },\n          \"estimatedTravelTime\": \"5 minute walk from Eiffel Tower\",\n          \"aiRecommendation\": \"Perfect spot for a picnic with views of the tower.\"\n        },\n        {\n          \"time\": \"Evening\",\n          \"locationName\": \"Dinner at Breizh Café\",\n          \"description\": \"Authentic Breton crêpes with savory and sweet options.\",\n          \"imageURL\": \"https://example.com/breizh_cafe.jpg\",\n          \"geoCoordinates\": {\n            \"latitude\": 48.865,\n            \"longitude\": 2.367\n          },\n          \"ticketPricing\": {\n            \"adult\": 25,\n            \"child\": 25,\n            \"currency\": \"EUR\"\n          },\n          \"estimatedTravelTime\": \"30 minute metro ride from Champ de Mars\",\n          \"aiRecommendation\": \"Try the 'Galette Saucisse' for a traditional Breton experience.\"\n        }\n      ]\n    },\n    {\n      \"day\": 2,\n      \"date\": \"2024-03-16\",\n      \"schedule\": [\n        {\n          \"time\": \"Morning\",\n          \"locationName\": \"Musée du Louvre\",\n          \"description\": \"World-renowned art museum housing masterpieces like the Mona Lisa.\",\n          \"imageURL\": \"https://example.com/louvre.jpg\",\n          \"geoCoordinates\": {\n            \"latitude\": 48.8606,\n            \"longitude\": 2.3376\n          },\n          \"ticketPricing\": {\n            \"adult\": 17,\n            \"child\": 0,\n            \"currency\": \"EUR\"\n          },\n          \"estimatedTravelTime\": \"30 minutes by metro from hotel\",\n          \"aiRecommendation\": \"Book tickets online in advance to avoid long queues. Focus on specific sections if you have limited time.\"\n        },\n        {\n          \"time\": \"Afternoon\",\n          \"locationName\": \"Tuileries Garden\",\n          \"description\": \"Beautiful garden connecting the Louvre to Place de la Concorde.\",\n          \"imageURL\": \"https://example.com/tuileries_garden.jpg\",\n          \"geoCoordinates\": {\n            \"latitude\": 48.8633,\n            \"longitude\": 2.3264\n          },\n          \"ticketPricing\": {\n            \"adult\": 0,\n            \"child\": 0,\n            \"currency\": \"EUR\"\n          },\n          \"estimatedTravelTime\": \"5 minute walk from Louvre\",\n          \"aiRecommendation\": \"Enjoy a leisurely stroll and relax by the fountains.\"\n        },\n        {\n          \"time\": \"Evening\",\n          \"locationName\": \"Dinner at Le Potager du Marais\",\n          \"description\": \"Vegan restaurant in the Marais district.\",\n          \"imageURL\": \"https://example.com/potager_du_marais.jpg\",\n          \"geoCoordinates\": {\n            \"latitude\": 48.8622,\n            \"longitude\": 2.3628\n          },\n          \"ticketPricing\": {\n            \"adult\": 30,\n            \"child\": 30,\n            \"currency\": \"EUR\"\n          },\n          \"estimatedTravelTime\": \"20 minute metro ride from Tuileries Garden\",\n          \"aiRecommendation\": \"Try the vegetable lasagna.\"\n        }\n      ]\n    },\n\t{\n      \"day\": 3,\n      \"date\": \"2024-03-17\",\n      \"schedule\": [\n        {\n          \"time\": \"Morning\",\n          \"locationName\": \"Sacré-Cœur Basilica\",\n          \"description\": \"Stunning basilica located on the highest point of Paris.\",\n          \"imageURL\": \"https://example.com/sacre-coeur.jpg\",\n          \"geoCoordinates\": {\n            \"latitude\": 48.8867,\n            \"longitude\": 2.3431\n          },\n          \"ticketPricing\": {\n            \"adult\": 0,\n            \"child\": 0,\n            \"currency\": \"EUR\"\n          },\n          \"estimatedTravelTime\": \"40 minutes by metro from hotel\",\n          \"aiRecommendation\": \"Take the funicular up to save your legs!  Enjoy the panoramic views.\"\n        },\n        {\n          \"time\": \"Afternoon\",\n          \"locationName\": \"Montmartre\",\n          \"description\": \"Artist district surrounding the Sacré-Cœur.\",\n          \"imageURL\": \"https://example.com/montmartre.jpg\",\n          \"geoCoordinates\": {\n            \"latitude\": 48.8867,\n            \"longitude\": 2.3431\n          },\n          \"ticketPricing\": {\n            \"adult\": 0,\n            \"child\": 0,\n            \"currency\": \"EUR\"\n          },\n          \"estimatedTravelTime\": \"Walking distance from Sacré-Cœur\",\n          \"aiRecommendation\": \"Wander the charming streets, watch street artists, and have lunch at a local bistro. Be aware of pickpockets.\"\n        },\n        {\n          \"time\": \"Evening\",\n          \"locationName\": \"Moulin Rouge\",\n          \"description\": \"Famous cabaret show (optional).\",\n          \"imageURL\": \"https://example.com/moulinrouge.jpg\",\n          \"geoCoordinates\": {\n            \"latitude\": 48.8837,\n            \"longitude\": 2.3329\n          },\n          \"ticketPricing\": {\n            \"adult\": 120,\n            \"child\": null,\n            \"currency\": \"EUR\"\n          },\n          \"estimatedTravelTime\": \"15 minute walk from Montmartre.\",\n          \"aiRecommendation\": \"Book tickets well in advance.  If you choose not to see the show, you can still take photos outside.\"\n        }\n      ]\n    },\n\t{\n      \"day\": 4,\n      \"date\": \"2024-03-18\",\n      \"schedule\": [\n        {\n          \"time\": \"Morning\",\n          \"locationName\": \"Notre Dame Cathedral\",\n          \"description\": \"Visit the iconic Notre Dame Cathedral\",\n          \"imageURL\": \"https://example.com/notredame.jpg\",\n          \"geoCoordinates\": {\n            \"latitude\": 48.8530,\n            \"longitude\": 2.3499\n          },\n          \"ticketPricing\": {\n            \"adult\": 0,\n            \"child\": 0,\n            \"currency\": \"EUR\"\n          },\n          \"estimatedTravelTime\": \"45 minutes by metro from hotel\",\n          \"aiRecommendation\": \"Visit Notre Dame Cathedral and learn about its historical significance. Note that interior access is currently limited due to restoration.\"\n        },\n        {\n          \"time\": \"Afternoon\",\n          \"locationName\": \"Latin Quarter\",\n          \"description\": \"Latin Quarter of Paris is known for its lively atmosphere\",\n          \"imageURL\": \"https://example.com/latinquarter.jpg\",\n          \"geoCoordinates\": {\n            \"latitude\": 48.8529,\n            \"longitude\": 2.3456\n          },\n          \"ticketPricing\": {\n            \"adult\": 0,\n            \"child\": 0,\n            \"currency\": \"EUR\"\n          },\n          \"estimatedTravelTime\": \"10 minute walk from Notre Dame Cathedral\",\n          \"aiRecommendation\": \"Explore the Latin Quarter with its famous bookshops, cafes, and historic buildings.\"\n        },\n        {\n          \"time\": \"Evening\",\n          \"locationName\": \"Dinner in Latin Quarter\",\n          \"description\": \"Vegan restaurant in the Latin Quarter district.\",\n          \"imageURL\": \"https://example.com/latinquarterrestaurants.jpg\",\n          \"geoCoordinates\": {\n            \"latitude\": 48.8622,\n            \"longitude\": 2.3628\n          },\n          \"ticketPricing\": {\n            \"adult\": 30,\n            \"child\": 30,\n            \"currency\": \"EUR\"\n          },\n          \"estimatedTravelTime\": \"Walking distance from the afternoon\",\n          \"aiRecommendation\": \"Have dinner in one of the many restaurants and enjoy a nice stroll.\"\n        }\n      ]\n    },\n\t{\n      \"day\": 5,\n      \"date\": \"2024-03-19\",\n      \"schedule\": [\n        {\n          \"time\": \"Morning\",\n          \"locationName\": \"Visit Musée Rodin\",\n          \"description\": \"Visit Musée Rodin\",\n          \"imageURL\": \"https://example.com/museerodin.jpg\",\n          \"geoCoordinates\": {\n            \"latitude\": 48.8561,\n            \"longitude\": 2.3179\n          },\n          \"ticketPricing\": {\n            \"adult\": 12,\n            \"child\": 0,\n            \"currency\": \"EUR\"\n          },\n          \"estimatedTravelTime\": \"45 minutes by metro from hotel\",\n          \"aiRecommendation\": \"Visit Musée Rodin to see the works of the famous sculptor Auguste Rodin.\"\n        },\n        {\n          \"time\": \"Afternoon\",\n          \"locationName\": \"Eiffel Tower (optional re-visit)\",\n          \"description\": \"Eiffel Tower (optional re-visit)\",\n          \"imageURL\": \"https://example.com/eiffeltower.jpg\",\n          \"geoCoordinates\": {\n            \"latitude\": 48.8584,\n            \"longitude\": 2.2945\n          },\n          \"ticketPricing\": {\n            \"adult\": 26.80,\n            \"child\": 7.10,\n            \"currency\": \"EUR\"\n          },\n          \"estimatedTravelTime\": \"15 minute walk from the Musee Rodin\",\n          \"aiRecommendation\": \"Re-visit the Eiffel Tower to take more pictures if the weather is nicer.\"\n        },\n        {\n          \"time\": \"Evening\",\n          \"locationName\": \"Dinner\",\n          \"description\": \"Dinner at a local restaurant in Saint-Germain\",\n          \"imageURL\": \"https://example.com/saintgermainrestaurants.jpg\",\n          \"geoCoordinates\": {\n            \"latitude\": 48.8550,\n            \"longitude\": 2.3342\n          },\n          \"ticketPricing\": {\n            \"adult\": 30,\n            \"child\": 30,\n            \"currency\": \"EUR\"\n          },\n          \"estimatedTravelTime\": \"Walking distance from the afternoon\",\n          \"aiRecommendation\": \"Explore Saint-Germain and enjoy dinner at a local restaurant.\"\n        }\n      ]\n    },\n\t{\n      \"day\": 6,\n      \"date\": \"2024-03-20\",\n      \"schedule\": [\n        {\n          \"time\": \"Morning\",\n          \"locationName\": \"Visit the Palace of Versailles\",\n          \"description\": \"Visit the Palace of Versailles\",\n          \"imageURL\": \"https://example.com/palaceofversailles.jpg\",\n          \"geoCoordinates\": {\n            \"latitude\": 48.8048,\n            \"longitude\": 2.1202\n          },\n          \"ticketPricing\": {\n            \"adult\": 20,\n            \"child\": 0,\n            \"currency\": \"EUR\"\n          },\n          \"estimatedTravelTime\": \"1 hour train ride from Paris\",\n          \"aiRecommendation\": \"Visit the Palace of Versailles (Château de Versailles) and explore its magnificent gardens and halls.\"\n        },\n        {\n          \"time\": \"Afternoon\",\n          \"locationName\": \"Gardens of Versailles\",\n          \"description\": \"Explore the gardens of Versailles\",\n          \"imageURL\": \"https://example.com/gardensversailles.jpg\",\n          \"geoCoordinates\": {\n            \"latitude\": 48.8024,\n            \"longitude\": 2.1193\n          },\n          \"ticketPricing\": {\n            \"adult\": 0,\n            \"child\": 0,\n            \"currency\": \"EUR\"\n          },\n          \"estimatedTravelTime\": \"Walk around the palace\",\n          \"aiRecommendation\": \"Take your time to walk around the gardens and admire the fountains and landscaping\"\n        },\n        {\n          \"time\": \"Evening\",\n          \"locationName\": \"Dinner in Paris\",\n          \"description\": \"Have dinner in Paris\",\n          \"imageURL\": \"https://example.com/parisrestaurants.jpg\",\n          \"geoCoordinates\": {\n            \"latitude\": 48.8566,\n            \"longitude\": 2.3522\n          },\n          \"ticketPricing\": {\n            \"adult\": 30,\n            \"child\": 30,\n            \"currency\": \"EUR\"\n          },\n          \"estimatedTravelTime\": \"1 hour train ride from Versailles back to Paris\",\n          \"aiRecommendation\": \"Enjoy the dinner at a restaurant in Paris\"\n        }\n      ]\n    },\n\t{\n      \"day\": 7,\n      \"date\": \"2024-03-21\",\n      \"schedule\": [\n        {\n          \"time\": \"Morning\",\n          \"locationName\": \"Visit the Marais district\",\n          \"description\": \"Visit the Marais district for last minute shopping\",\n          \"imageURL\": \"https://example.com/marais.jpg\",\n          \"geoCoordinates\": {\n            \"latitude\": 48.8578,\n            \"longitude\": 2.3580\n          },\n          \"ticketPricing\": {\n            \"adult\": 0,\n            \"child\": 0,\n            \"currency\": \"EUR\"\n          },\n          \"estimatedTravelTime\": \"45 minutes by metro from hotel\",\n          \"aiRecommendation\": \"Visit the Marais district for a last minute shopping spree\"\n        },\n        {\n          \"time\": \"Afternoon\",\n          \"locationName\": \"Free for shopping\",\n          \"description\": \"Free for shopping\",\n          \"imageURL\": \"https://example.com/shopping.jpg\",\n          \"geoCoordinates\": {\n            \"latitude\": 48.8578,\n            \"longitude\": 2.3580\n          },\n          \"ticketPricing\": {\n            \"adult\": 0,\n            \"child\": 0,\n            \"currency\": \"EUR\"\n          },\n          \"estimatedTravelTime\": \"Walk around the district\",\n          \"aiRecommendation\": \"Have a look around and make some purchases\"\n        },\n        {\n          \"time\": \"Evening\",\n          \"locationName\": \"Dinner in the Marais\",\n          \"description\": \"Dinner in the Marais district\",\n          \"imageURL\": \"https://example.com/maraisrestaurants.jpg\",\n          \"geoCoordinates\": {\n            \"latitude\": 48.8578,\n            \"longitude\": 2.3580\n          },\n          \"ticketPricing\": {\n            \"adult\": 30,\n            \"child\": 30,\n            \"currency\": \"EUR\"\n          },\n          \"estimatedTravelTime\": \"Walk around the district\",\n          \"aiRecommendation\": \"Have your last dinner and goodnight\"\n        }\n      ]\n    }\n  ],\n  \"weatherForecast\": {\n    \"date\": \"2024-03-15\",\n    \"temperature\": {\n      \"high\": 12,\n      \"low\": 5,\n      \"unit\": \"Celsius\"\n    },\n    \"condition\": \"Partly Cloudy\",\n    \"windSpeed\": 15,\n    \"windUnit\": \"km/h\",\n    \"aiRecommendation\": \"Pack layers as the weather can be unpredictable in March. Bring an umbrella or raincoat.\"\n  }\n}\n```\n\n**Explanation and Key Considerations:**\n\n*   **JSON Structure:** The data is formatted in JSON, making it easy to parse and use in applications.\n\n*   **`queryParameters`:**  This section reflects your initial input, allowing for easy reference.\n\n*   **`budgetEstimation`:**  Provides a breakdown of estimated costs. This is crucial for travelers on a budget. You'll need to research flight costs specifically based on your departure location.\n\n*   **`accommodationOptions`:** Includes a list of hotels fitting your preference for boutique hotels.  *Crucially, replace the example image URLs with actual URLs*. The price is an estimate. I have also added more information like geo coordinates.\n    *   The `aiRecommendation` within each hotel is tailored to the user's overall travel style and preferences.\n\n*   **`aiRecommendations`:** This section lists tailored suggestions based on your `travelType` and `preferredActivities`.\n\n*   **`itinerary`:**\n    *   **Day-wise Structure:**  Organizes the plan day by day.\n    *   **Time Slots:** Morning, Afternoon, Evening allow for a structured schedule.\n    *   **Detailed Information:** Includes `locationName`, `description`, `imageURL`, `geoCoordinates`, `ticketPricing`, and `estimatedTravelTime`.  *Remember to find real image URLs and double-check pricing.*\n    *   **AI Recommendations:** Provides specific tips for each location and time of day to optimize the experience.\n    *   **Realistic Travel Times:** Use Google Maps or a similar tool to get accurate travel time estimates between locations using public transport.\n\t*\t**Day 4-7** I added more details to these days.\n\n*   **`weatherForecast`:**  Provides a basic weather forecast for the start date.  *You'll need to integrate with a real weather API for real-time updates.* Consider adding a more detailed forecast (e.g., precipitation probability, humidity).\n\n**Important Next Steps (Replace Placeholders and Integrate Real Data):**\n\n1.  **Replace Placeholders:** Substitute all the placeholders (e.g., `Paris, France`, `2024-03-15`, `1500 EUR`, hotel image URLs, activity costs) with your actual information.\n2.  **Hotel Research:** Use hotel booking websites (Booking.com, Expedia, etc.) to find specific hotels that fit your criteria. Get accurate prices, images, addresses, ratings, and geo-coordinates.\n3.  **Activity Pricing:** Research the entrance fees and costs of your desired activities online.\n4.  **Transportation Costs:** Estimate the cost of flights and local transportation (metro, bus, etc.).\n5.  **Image URLs:** Find actual, high-quality image URLs for all the locations in your itinerary.\n6.  **Weather API Integration:**  Integrate with a weather API (e.g., OpenWeatherMap) to fetch real-time weather forecasts for Paris for the duration of your trip.\n7.  **Travel Time Validation:** Double-check the `estimatedTravelTime` between locations using a mapping tool.\n8.  **AI-Powered Personalization (Advanced):** To make the AI recommendations even more relevant, you could consider using a more sophisticated AI model that can analyze the user's past travel history, preferences, and reviews.\n\n**Example of integrating with a weather API (using Python):**\n\n```python\nimport requests\n\ndef get_weather(city, api_key):\n  url = f\"http://api.openweathermap.org/data/2.5/weather?q={city}&appid={api_key}&units=metric\"\n  response = requests.get(url)\n  data = response.json()\n  if data[\"cod\"] == 200:\n    temperature = data[\"main\"][\"temp\"]\n    description = data[\"weather\"][0][\"description\"]\n    # ... (build the weatherForecast dictionary)\n  else:\n    print(\"Error fetching weather:\", data[\"message\"])\n    return None\n```\n\nRemember to install the `requests` library (`pip install requests`).\n\nBy following these steps, you can transform this template into a truly personalized and valuable travel plan. Let me know if you'd like help with any specific aspect, like finding hotel image URLs or crafting more AI-based recommendations!\n" },
                    ],
                },
            ],
        });

        const result = await chatSession.sendMessage(prompt);
        
        
        
        const save = await TripModel.create({ userId: user.id, data: JSON.parse(result.response.text()) });
        if (save) {
            res.status(200).json({ status: true, msg: result.response.text(), id: save._id });
        }
    } catch (error) {
        console.log(error);
        res.status(500).json({ status: false, msg: error.message });
    }
}

exports.getTrip = async (req, res) => {
    try {
        const { id } = req.params;
        const trip = await TripModel.findById(id);
        if (trip) {
            res.status(200).json({ status: true, trip: trip });
        } else {
            res.status(404).json({ status: false, msg: "Trip not found", statusCode: 404 });
        }
    } catch (error) {
        console.log(error);
        res.status(500).json({ status: false, msg: error, statusCode: 500 });
    }
}

exports.getTripByUser = async (req, res) => {
    try {
        const token = req.headers.authorization;
        const splited = token.split(" ")[1];
        const user = verifyToken(splited);
        const trip = await TripModel.find({ userId: user.id });
        
        
        if (trip) {
            res.status(200).json({ status: true, trip: trip });
        } else {
            res.status(404).json({ status: false, msg: "Trip not found", statusCode: 404 });
        }
    } catch (error) {
        console.log(error);
        res.status(500).json({ status: false, msg: error, statusCode: 500 });
    }
}